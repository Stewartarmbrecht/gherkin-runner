<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gherkin Runner</title>

  <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
  <link href="gherkinRunner.css" rel="stylesheet">
</head>

<body>
<iframe id="uitestwindow" width="100%" height="100%" style="display: none"></iframe>
<iframe id="apitestwindow" width="100%" height="100%" style="display: none"></iframe>
<div id="gherkin-ui" class="hidden" data-bind="css: { hidden: view() != 'Running'}">
  <div class="controls">
    <div class="btn-group additional-controls">
      <button class="btn btn-sm btn-default exception-break" title="Currently NOT breaking on exceptions"
              data-bind="visible: !breakOnException(), click: toggleOnException">
        <i class="fa fa-bug fa-large faded"></i>
      </button>
      <button class="btn btn-sm btn-default exception-continue" title="Currently breaking on exceptions"
              data-bind="visible: breakOnException(), click: toggleOnException">
        <i class="fa fa-bug fa-large text-danger"></i>
      </button>
      <button class="btn btn-sm btn-default expand-all" title="Expand All Sections"
              data-bind="visible: allCollapsed(), click: toggleRunnerCollapse">
        <i class="fa fa-expand fa-large"></i>
      </button>
      <button class="btn btn-sm btn-default collapse-all" title="Collapse All Sections"
              data-bind="visible: !allCollapsed(), click: toggleRunnerCollapse">
        <i class="fa fa-compress fa-large"></i>
      </button>
      <button class="btn btn-sm btn-default link-to-page" data-bind="click: $root.linkToPage">Link It</button>
      <button class="btn btn-sm btn-default reload" data-bind="click: load"><i class="fa fa-refresh"></i>&nbsp;Reload</button>
    </div>
    <div class="main-controls pull-right">
      <div class="btn-group main-controls pull-right" data-bind="css: { faded: uiWindowVisible }">
        <button class="play btn btn-sm btn-primary" data-bind="click: run">
          <i class="fa fa-play"></i>&nbsp;Run
        </button>
        <button class="stop btn btn-sm btn-warning" data-bind="click: cancel">
          <i class="fa fa-stop"></i>&nbsp;Cancel</button>
        <button class="pause btn btn-sm btn-warning" data-bind="click: pauseOrUnPause, visible: !paused()">
          <i class="fa fa-pause"></i>&nbsp;Pause
        </button>
        <button class="continue btn btn-sm btn-warning" data-bind="click: pauseOrUnPause, visible: paused">
          <i class="fa fa-play"></i>&nbsp;Continue
        </button>
        <button class="toggle-ui btn btn-sm" data-bind="click: toggleUI">Toggle UI</button>
        <button class="move-main-controls btn btn-sm" data-bind="click: $root.toggleUIButtonMove">&nbsp;
          <i class="fa fa-angle-double-right" data-bind="visible: $root.toggleUIButtonPosition() === 'left'"></i>
          <i class="fa fa-angle-double-left" data-bind="visible: $root.toggleUIButtonPosition() === 'right'"></i>
        </button>
      </div>
    </div>
  </div>
  <!-- ko if: loaded -->
  <div class="feature-sets contain-fluid"
       data-bind="attr: { id: id }, template: { name: 'featureSetTemplate', data: featureSet }">
  </div>
  <!-- ko if: recommendedMethods().length > 0 -->
  <div id="recommended-methods" class="recommended-methods">
    <h4>Recommended Library Methods:</h4>
    <pre><code data-bind="foreach: recommendedMethods"><span data-bind="text: $data"></span></code></pre>
  </div>
  <!-- /ko -->
  <!-- /ko -->
</div>

<script type="text/html" id="icons">
  <div class="hidden-xs hidden-sm">
    <span class="breakpoint">
      <!-- ko if: type !== 'step' -->
        <a class="can-click"
           data-bind="visible: childBreakpoints() > 0, click: $root.setBreakpoint">
          <i class="fa fa-circle text-danger faded" title="Remove breakpoint"></i>
        </a>
      <!-- /ko -->
      <!-- ko if: type === 'step' -->
        <a class="hover-visible can-click"
           data-bind="visible: !breakpoint() && childBreakpoints() < 1 && !outline, click: setBreakpoint">
          <i class="fa fa-circle-o text-muted" title="Add breakpoint"></i>
        </a>
        <a class="can-click"
           data-bind="visible: (breakpoint() || childBreakpoints() > 0) && !outline, click: setBreakpoint">
          <i class="fa fa-circle text-muted text-danger" title="Remove breakpoint"></i>
        </a>
      <!-- /ko -->
    </span>
    <span class="last-run-result">
      <i class="fa fa-check-circle-o text-success faded" title="Passed"
         data-bind="visible: lastRunResult() === 1"></i>
      <!-- ko if: type !== 'step' -->
        <i class="fa fa-times-circle text-danger faded" title="Failed"
           data-bind="visible: lastRunResult() === -1"></i>
      <!-- /ko -->
      <!-- ko if: type === 'step' -->
        <a class="can-click" data-bind="click: toggleLastErrorExpanded, visible: lastRunResult() === -1">
          <i class="fa fa-times-circle text-danger faded" title="Failed"></i>
        </a>
      <!-- /ko -->
      <i class="fa fa-question-circle faded" title="Skipped" data-bind="visible: lastRunResult() === 0"></i>
      <i class="fa fa-adjust text-warning faded" title="Canceled" data-bind="visible: lastRunResult() === 2"></i>
    </span>
    <span class="run-result">
      <i class="fa fa-check-circle-o text-success" title="Passed" data-bind="visible: runResult() === 1"></i>
      <!-- ko if: type !== 'step' -->
        <i class="fa fa-times-circle text-danger" title="Failed" data-bind="visible: runResult() === -1"></i>
      <!-- /ko -->
      <!-- ko if: type === 'step' -->
        <a class="can-click" data-bind="click: toggleErrorExpanded, visible: runResult() === -1">
          <i class="fa fa-times-circle text-danger" title="Failed"></i>
        </a>
      <!-- /ko -->
      <i class="fa fa-question-circle" title="Skipped" data-bind="visible: runResult() === 0"></i>
      <i class="fa fa-adjust text-warning" title="Canceled" data-bind="visible: runResult() === 2"></i>
    </span>
    <span class="missing-methods">
      <!-- ko if: type === 'step' -->
        <i class="fa fa-ban text-danger" title="Missing Method" data-bind="visible: missingMethod"></i>
      <!-- /ko -->
      <i class="fa fa-ban text-danger" title="Missing Child Methods"
         data-bind="visible: childMissingMethod() > 0"></i>
    </span>
    <span class="details">
      <a class="hover-visible can-click" data-bind="click: toggleDetailsExpanded">
        <i class="fa fa-info-circle" title="Description"></i>
      </a>
    </span>
    <span class="comment">
      <!-- ko if: comments && comments() && comments().length > 0 -->
        <a class="can-click" data-bind="click: toggleCommentsExpanded">
          <i class="fa fa-comment-o" title="Comments"></i>
        </a>
      <!-- /ko -->
      <!-- ko if: !comments || !comments() || comments().length <= 0 -->
        <i class="fa fa-info-circle invisible" title="Description"></i>
      <!-- /ko -->
    </span>
    <span class="reset-state-and-run">
      <a class="hover-visible can-click" data-bind="click: $root.runSingleScenarioAndResetState">
        <i class="fa fa-play-circle text-info" title="Reset State and Run"></i>
      </a>
    </span>
    <span class="run">
      <a class="hover-visible can-click" data-bind="click: $root.runSingleScenario">
        <i class="fa fa-play-circle-o text-info" title="Run with Existing State"></i>
      </a>
    </span>
  </div>
</script>

<script type="text/html" id="featureSetTemplate">
  <div class="feature-set row">
    <div class="icons col-md-2" data-bind="template: {name: 'icons', data: $data }"></div>
    <div class="title col-md-8">
      <div data-bind="attr: { 'class': 'level-' + level }">
        <span class="label label-default visible-sm-inline">FS:</span>
        <span class="label label-default hidden-xs hidden-sm">Feature Set:</span>
        <a class="name">
          <h3 class="inline" data-bind="click: toggleExpanded, text: name, css: { 'text-success': runResult() === 1 }"></h3>
        </a>
      </div>
    </div>
    <div class="run-result-bar col-md-2" data-bind="template: { name: 'counts', data: $data }"></div>
  </div>
  <!-- ko if: detailsExpanded -->
    <div class="description row">
      <div class="col-md-10 col-md-offset-2">
        <div data-bind="attr: { 'class': 'well well-sm level-' + (level + 2)}">
          <div data-bind="text: description"></div>
          <div data-bind="text: 'Path: ' + path"></div>
        </div>
      </div>
    </div>
  <!-- /ko -->
  <!-- ko if: expanded -->
    <!-- ko template: { name: 'featureTemplate', foreach: features } --><!-- /ko -->
    <!-- ko template: { name: 'featureSetTemplate', foreach: featureSets } --><!-- /ko -->
  <!-- /ko -->
</script>

<script type="text/html" id="featureTemplate">
  <div class="feature row">
    <div class="icons col-md-2" data-bind="template: {name: 'icons', data: $data }"></div>
    <div class="title col-md-8">
      <a data-bind="click: toggleExpanded, attr: { 'class': 'can-click level-' + level }">
        <span class="label label-primary">Feature:</span>
        <span class="name" data-bind="text: name, css: { 'text-success': runResult() === 1 }"></span>
      </a>
    </div>
    <div class="run-result-bar col-md-2" data-bind="template: { name: 'counts', data: $data }"></div>
  </div>
  <!-- ko if: detailsExpanded -->
    <div class="description row">
      <div class="col-md-10 col-md-offset-2">
        <pre data-bind="attr: { 'class': 'level-' + (level + 2) }"><code
          data-bind="text: description().join('\n')"></code><code data-bind="text: '\n\nPath: ' + path"></code></pre>
      </div>
    </div>
  <!-- /ko -->
  <!-- ko if: commentsExpanded -->
    <div class="comments row">
      <div class="col-md-10 col-md-offset-2">
        <pre data-bind="attr: { 'class': 'level-' + (level + 2) }"><code data-bind="text: comments().join('\n')"></code></pre>
      </div>
    </div>
  <!-- /ko -->
  <!-- ko if: expanded -->
    <!-- ko template: { name: 'scenarioTemplate', foreach: backgrounds } --><!-- /ko -->
    <!-- ko template: { name: 'scenarioTemplate', foreach: scenarios } --><!-- /ko -->
    <!-- ko template: { name: 'scenarioTemplate', foreach: stepGroups } --><!-- /ko -->
  <!-- /ko -->
</script>

<script type="text/html" id="scenarioTemplate">
  <div class="feature row">
    <div class="icons col-md-2" data-bind="template: {name: 'icons', data: $data }"></div>
    <div class="title col-md-8">
      <a data-bind="click: toggleExpanded, attr: { 'class': 'can-click level-' + level }">
        <!-- ko if: exampleArgDisplay -->
          <pre><code data-bind="text: exampleArgDisplay"></code></pre>
        <!-- /ko -->
        <!-- ko ifnot: exampleArgDisplay -->
          <span class="label label-info"
                data-bind="text: type.substring(0,1).toUpperCase() + type.substring(1) + ': '"></span>
          <span class="name"
                data-bind="
                  text: name,
                  css: {
                    'text-danger': childMissingMethod() > 0 || runResult() == -1,
                    'text-success': runResult() === 1
                  }"></span>
        <!-- /ko -->
      </a>
    </div>
    <div class="run-result-bar col-md-2" data-bind="template: { name: 'counts', data: $data }"></div>
  </div>
  <!-- ko if: commentsExpanded -->
  <div class="comments row">
    <div class="col-md-10 col-md-offset-2">
      <pre data-bind="attr: { 'class': 'level-' + (level + 2) }"><code data-bind="text: comments().join('\n')"></code></pre>
    </div>
  </div>
  <!-- /ko -->
  <!-- ko if: expanded -->
    <!-- ko template: { name: 'stepTemplate', foreach: steps } --><!-- /ko -->
    <!-- ko if: scenarios !== undefined && scenarios().length > 0 -->
      <div class="examples row">
        <div class="col-md-10 col-md-offset-2">
          <div data-bind="attr: { 'class': 'level-' + (level + 2) }">Examples</div>
        </div>
      </div>
      <div class="example-args row">
        <div class="col-md-10 col-md-offset-2">
          <pre data-bind="attr: { 'class': 'level-' + (level + 2) }"><code class="preserve-space example-arg-columns"
                        data-bind="text: exampleArgColumnsDisplay"></code></pre>
        </div>
      </div>
      <!-- ko template: { name: 'scenarioTemplate', foreach: scenarios } --><!-- /ko -->
    <!-- /ko -->
  <!-- /ko -->
</script>

<script type="text/html" id="stepTemplate">
  <div class="feature row">
    <div class="icons col-md-2" data-bind="template: {name: 'icons', data: $data }"></div>
    <div class="title col-md-8">
      <!-- ko if: steps().length === 0-->
        <span data-bind="
                attr: {
                  'class': 'can-click level-' + level +
                    (childMissingMethod() > 0?' text-danger':'') +
                    (runResult() === 1?' text-success':'')
                }">
          <span data-bind="
            text: name"></span>
          <!-- ko if: runCondition -->
            <span data-bind="text: ' if(' + runCondition + ')'"></span>
          <!-- /ko -->
        </span>
      <!-- /ko -->
      <!-- ko if: steps().length > 0 -->
        <a data-bind="
              click: toggleExpanded,
              attr: {
                  'class': 'can-click level-' + level +
                    (childMissingMethod() > 0?' text-danger':'') +
                    (runResult() === 1?' text-success':'')
                }">
          <span data-bind="text: name"></span>
          <!-- ko if: runCondition -->
            <span data-bind="text: ' if(' + runCondition + ')'"></span>
          <!-- /ko -->
        </a>
      <!-- /ko -->
    </div>
    <div class="run-result-bar col-md-2" data-bind="template: { name: 'counts', data: $data }"></div>
  </div>
  <!-- ko if: detailsExpanded -->
    <div class="details row">
      <div class="col-md-10 col-md-offset-2">
        <small data-bind="attr: { 'class': 'well well-sm level-' + level }">
          <div>
            <span>Library: </span><code data-bind="text: libraryName"></code>
          </div>
          <div>
            <span>Method Name: </span><code data-bind="text: libraryMethodName"></code>
          </div>
          <div>
            <span>Method: </span>
            <pre><code data-bind="text: method ? method.toString() : ''"></code></pre>
          </div>
        </small>
      </div>
    </div>
  <!-- /ko -->
  <!-- ko if: commentsExpanded -->
    <div class="comments row">
      <div class="col-md-10 col-md-offset-2">
        <pre data-bind="attr: { 'class': 'level-' + (level + 2) }"><code data-bind="text: comments().join('\n')"></code></pre>
      </div>
    </div>
  <!-- /ko -->
  <!-- ko if: errorExpanded -->
    <!-- ko template: { name: 'errorTemplate', data: error } --><!-- /ko -->
  <!-- /ko -->
  <!-- ko if: lastErrorExpanded -->
    <!-- ko template: { name: 'errorTemplate', data: lastError } --><!-- /ko -->
  <!-- /ko -->
  <!-- ko if: multiLineArg && multiLineArg.length > 0 -->
    <div class="multi-line-arg row">
      <div class="col-md-10 col-md-offset-2">
        <pre data-bind="attr: { 'class': 'level-' + (level + 2) }"><code data-bind="text: multiLineArg.join('\n')"></code></pre>
      </div>
    </div>
  <!-- /ko -->
  <!-- ko if: tableArg && tableArg.length > 0 -->
    <div class="table-arg row">
      <div class="col-md-10 col-md-offset-2">
        <div data-bind="attr: { 'class': 'table-responsive level-' + (level + 2) }">
          <table class="table table-bordered table-striped table-condensed table-nonfluid">
            <thead>
            <tr data-bind="foreach: tableArgColumns">
              <th>
                <small data-bind="text: $data"></small>
              </th>
            </tr>
            </thead>
            <tbody data-bind="foreach: tableArgArray">
            <tr data-bind="foreach: $data">
              <td>
                <small data-bind="text: $data"></small>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <!-- /ko -->
  <!-- ko if: expanded -->
    <!-- ko if: steps().length > 0 -->
      <!-- ko template: { name: 'stepTemplate', foreach: steps } --><!-- /ko -->
    <!-- /ko -->
  <!-- /ko -->
</script>

<script type="text/html" id="errorTemplate">
  <div class="error row">
    <div class="col-md-10 col-md-offset-2">
      <div data-bind="attr: { 'class': 'alert alert-danger level-' + (level + 2) }">
        <!-- ko if: stack -->
        <small><pre data-bind="text: stack"></pre></small>
        <!-- /ko -->
        <!-- ko if: responseText -->
        <small><pre data-bind="text: responseText"></pre></small>
        <!-- /ko -->
        <!-- ko if: entityErrors -->
        <!-- ko foreach: entityErrors -->
        <small><pre data-bind="text: errorMessage"></pre></small>
        <!-- /ko -->
        <!-- /ko -->
      </div>
    </div>
  </div>
</script>

<script type="text/html" id="stepGroupTemplate">
  <div class="step-group">
    <div class="title hover hover-highlighted">
      <div class="icons">
        <div class="icon-column">
          <i class="fa fa-ban text-danger" data-bind="visible: childMissingMethod() > 0 "></i>
        </div>
      </div>
      <div class="name">
        <a class="can-click" data-toggle="collapse"
           data-bind="attr: { 'href': '#' + id }">
          <span data-bind="text: 'Step Group: ' + name, css: { 'text-danger': childMissingMethod() > 0 }"></span>
          (<span data-bind="text: used, attr: {title: 'Used ' + used + ' times'}"></span>)
        </a>
      </div>
      <div class="pull-right run-result-bar" data-bind="template: { name: 'counts', data: $data }"></div>
    </div>
    <div class="body collapse collapsible"
         data-bind="attr: { id: id }">
      <div class="steps" data-bind="template: { name: 'stepTemplate', foreach: steps }">
      </div>
    </div>
  </div>
</script>

<script type="text/html" id="recommendedMethods">
  <div class="recommended-method">
  </div>
</script>

<script type="text/html" id="counts">
  <table class="count-table" data-bind="attr: {title: 'Loaded: ' + childLoaded() + '\nMissing Methods: ' + childMissingMethod() + '\nRun: ' + childRun() + '\nPassed: ' + childPassed() + '\nFailed: ' + childFailed() + '\nSkipped: ' + childSkipped()}">
    <tr>
      <td data-bind="style: { width: Math.floor((((childLoaded()!==0?childLoaded():1) - childRun()) / (childLoaded()!==0?childLoaded():1)) * 100) + '%' }"></td>
      <td class="bg-success" data-bind="style: { width: Math.floor((childPassed() / childLoaded()) * 100) + '%' }"></td>
      <td class="bg-warning" data-bind="style: { width: Math.floor((childSkipped() / childLoaded()) * 100) + '%' }"></td>
      <td class="bg-danger" data-bind="style: { width: Math.floor((childFailed() / childLoaded()) * 100) + '%' }"></td>
    </tr>
  </table>
</script>

<script type="text/javascript" src="vendor/jquery/dist/jquery.js"></script>
<script type="text/javascript" src="vendor/knockout/dist/knockout.js"></script>
<script type="text/javascript" src="vendor/bootstrap/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="scripts/jquery.address-1.6.js"></script>
<script type="text/javascript" src="vendor/cajon/cajon.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    requirejs.onError = function (err) {
      var errorMsg = "error: " + err + "\n" + err.stack;
      console.log(err);
      console.log(errorMsg);
      alert(errorMsg);
    };
    require.config({ baseUrl: "/" });
    require(["gherkin-runner/gherkinRunner"/*, "../GherkinRunnerConfiguration?noExt"*/], function (gherkinRunner, config) {
      //$.restfulBreeze.setRootUrl(config.apiUrl);
      gherkinRunner.addFeatureSetFromUrl();
      //gherkinRunner.config = config;
      gherkinRunner.load();
    });
  });
</script>
</body>
</html>
